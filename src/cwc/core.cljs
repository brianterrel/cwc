(ns cwc.core
    (:require [reagent.core :as reagent :refer [atom]]))

(enable-console-print!)

;;-------------------------
;; Data & Data Functions

(def data-2017 [1 1 1 2 2 2 2 3 3 4 5 6 8 10 11 12 16 20 21 25 32 39 48 54 75 100 105 124 151 190 200 242 280 301 352 410 492 501 554 603 700 800 850 915 1000 1000 1021 1074 1200 1202 1300 1403 1500 1520 1620 1722 1803 1940 2000 2000 2000 2015 2102 2220 2368 2400 2500 2528 2664 2800 2940 3000 3000 3000 3010 3104 3200 3360 3500 3597 3608 3767 3930 4000 4000 4002 4080 4200 4352 4500 4554 4772 4800 4918 5000 5000 5000 5000 5005 5064 5200 5300 5448 5502 5636 5790 5930 6000 6000 6000 6001 6020 6095 6240 6376 6500 6600 6707 6869 7000 7000 7000 7040 7200 7200 7259 7325 7465 7511 7658 7788 7859 7968 8000 8000 8000 8003 8059 8160 8256 8375 8400 8403 8460 8508 8592 8652 8724 8784 8796 8815 8820 8859 8928 9000 9000 9000 9020 9060 9132 9239 9312 9402 9500 9600 9600 9648 9659 9719 9823 9899 9993 10000 10000 10000 10000 10000 10000 10000 10003 10019 10055 10080 10139 10200 10250 10308 10367 10416 10500 10560 10631 10715 10800 10805 10859 10884 10979 11000 11000 11036 11116 11209 11315 11403 11495 11567 11652 11760 11858 11952 12000 12000 12000 12000 12000 12000 12001 12003 12020 12059 12096 12159 12241 12325 12431 12500 12600 12700 12840 12959 13000 13000 13000 13014 13089 13199 13200 13248 13269 13338 13439 13503 13600 13705 13818 13938 14000 14000 14000 14015 14110 14240 14352 14400 14400 14459 14482 14547 14669 14800 14944 15000 15000 15000 15000 15000 15000 15000 15000 15001 15002 15010 15050 15120 15212 15327 15443 15539 15600 15607 15659 15685 15792 15882 15984 16000 16000 16000 16003 16043 16129 16216 16320 16429 16502 16610 16731 16800 16859 16900 17000 17000 17000 17002 17038 17124 17243 17369 17500 17588 17700 17844 18000 18000 18000 18000 18000 18000 18005 18048 18081 18192 18250 18400 18500 18628 18721 18859 19000 19000 19000 19008 19084 19200 19228 19274 19439 19556 19700 19820 19995 20000 20000 20000 20000 20000 20000 20000 20000 20000 20000 20000 20002 20003 20010 20022 20059 20142 20223 20364 20420 20488 20548 20650 20800 20809 20968 21000 21000 21005 21066 21212 21350 21500 21600 21649 21754 21878 22000 22000 22000 22000 22005 22049 22192 22300 22481 22577 22715 22814 22896 23000 23000 23000 23003 23036 23145 23296 23401 23520 23657 23838 24000 24000 24000 24000 24000 24002 24010 24054 24159 24336 24500 24663 24839 24960 25000 25000 25000 25000 25000 25000 25000 25000 25000 25000 25002 25005 25010 25025 25080 25163 25259 25366 25502 25634 25843 26000 26000 26000 26000 26002 26030 26140 26364 26496 26639 26806 27000 27000 27000 27003 27031 27110 27265 27480 27600 27764 27960 28000 28000 28000 28000 28003 28015 28081 28200 28357 28502 28640 28810 28969 29000 29003 29080 29201 29391 29549 29773 30000 30000 30000 30000 30000 30000 30000 30000 30000 30000 30000 30000 30000 30000 30001 30002 30004 30008 30013 30024 30045 30078 30132 30222 30350 30502 30656 30840 31000 31001 31020 31120 31200 31293 31489 31586 31770 32000 32000 32000 32000 32002 32008 32025 32105 32254 32448 32569 32753 33000 33000 33003 33035 33230 33442 33624 33842 34000 34001 34013 34094 34301 34520 34762 34968 35000 35000 35000 35000 35000 35000 35000 35000 35001 35002 35006 35015 35035 35097 35163 35300 35420 35569 35802 36000 36000 36000 36002 36011 36040 36150 36319 36453 36619 36866 37000 37002 37033 37204 37355 37502 37740 38000 38000 38000 38002 38016 38089 38218 38426 38645 38929 39000 39005 39101 39336 39601 39836 40000 40000 40000 40000 40000 40000 40000 40000 40000 40002 40003 40006 40010 40016 40029 40050 40100 40200 40301 40455 40616 40843 41000 41010 41144 41397 41600 41711 42000 42000 42000 42003 42017 42060 42203 42403 42542 42760 43000 43001 43037 43200 43429 43650 43925 44000 44029 44201 44459 44760 45000 45000 45000 45000 45000 45001 45003 45008 45014 45032 45063 45126 45225 45400 45577 45756 46000 46000 46017 46145 46392 46615 46901 47000 47023 47208 47499 47711 47992 48000 48001 48010 48035 48144 48367 48680 49000 49013 49200 49442 49744 50000 50000 50000 50000 50000 50000 50000 50001 50002 50005 50009 50014 50024 50042 50081 50144 50271 50404 50558 50808 51000 51025 51200 51488 51772 52000 52000 52005 52029 52114 52347 52672 52969 53006 53114 53400 53712 54000 54008 54136 54427 54706 55000 55000 55000 55003 55010 55029 55087 55200 55361 55618 55993 56002 56060 56267 56532 56826 57010 57200 57505 57937 58002 58052 58301 58660 59000 59115 59495 59870 60000 60000 60000 60000 60001 60003 60007 60013 60025 60050 60095 60170 60304 60470 60730 61002 61150 61444 61828 62000 62033 62259 62543 62941 63032 63363 63748 64012 64302 64709 65000 65000 65001 65005 65016 65050 65144 65316 65550 65912 66010 66286 66741 67010 67222 67641 68000 68042 68359 68789 69020 69288 69852 70000 70000 70002 70007 70020 70050 70145 70317 70562 70904 71173 71600 72000 72014 72201 72560 73000 73269 73801 74020 74468 75000 75000 75000 75005 75020 75058 75162 75331 75635 76000 76100 76614 77008 77450 78000 78042 78635 79036 79525 80000 80000 80001 80008 80025 80083 80215 80468 80883 81100 81579 82000 82113 82727 83077 83606 84016 84511 85000 85010 85075 85375 85959 86282 87000 87436 88023 88546 89065 89875 90000 90010 90042 90193 90490 91000 91500 92003 92400 93027 93617 94200 95000 95040 95469 96000 96407 97030 97800 98225 99029 99999 100000 100002 100009 100028 100088 100203 100460 100906 101300 101893 102374 103002 103792 104475 105026 105611 106482 107556 108512 109500 110000 110034 110309 111257 112145 113299 114441 115083 116006 117151 118650 120000 120006 120100 120543 121506 122511 124000 125000 125200 126014 127187 128800 130000 130130 131000 132510 134473 136000 138000 140000 140265 141943 144001 145470 147585 150000 150010 150172 150820 152000 153650 155595 158071 160034 162000 165000 167470 170413 173682 175738 179500 181739 185100 190000 193100 199775 200155 202196 207010 214179 220806 228452 237855 250000 252819 262048 280116 300000 313328 343243 380000 425007 501000 680000 1094565])

(def diffs [-7 -7 -42 -67 -84 -102 -128 -144 -170 -169 -203 -211 -252 -250 -267 -292 -331 -345 -396 -409 -402 -395 -430 -467 -446 -465 -503 -527 -509 -505 -538 -540 -571 -568 -517 -459 -394 -446 -463 -440 -386 -312 -314 -328 -303 -303 -282 -264 -190 -258 -221 -161 -151 -218 -118 -16 65 202 227 166 88 34 16 126 195 227 310 268 370 427 507 480 393 393 403 497 593 709 762 790 714 795 888 958 871 864 864 863 945 1023 1077 1295 1323 1372 1350 1289 1245 1141 1094 1135 1202 1189 1276 1313 1325 1444 1584 1654 1654 1654 1586 1535 1575 1651 1717 1780 1820 1901 1993 2028 1959 1889 1842 1985 1985 2044 2110 2250 2235 2339 2443 2435 2492 2437 2368 2350 2284 2322 2415 2415 2465 2429 2353 2376 2424 2508 2498 2466 2526 2468 2426 2345 2340 2357 2342 2264 2220 2188 2124 2178 2285 2358 2388 2407 2412 2342 2347 2288 2313 2339 2337 2361 2282 2255 2177 2177 2177 2177 2116 2067 1988 1963 1936 1899 1908 1906 1938 1918 1889 1904 1903 1939 2023 2108 2113 2167 2166 2200 2134 2108 2066 2076 2134 2188 2224 2229 2249 2265 2364 2366 2391 2439 2439 2369 2300 2221 2108 2040 1981 1902 1846 1813 1781 1810 1894 2000 2069 2169 2269 2392 2424 2396 2352 2257 2175 2224 2247 2213 2174 2108 2090 2139 2203 2283 2318 2344 2421 2422 2318 2231 2150 2150 2219 2252 2231 2231 2212 2139 2117 2152 2248 2323 2275 2205 2136 2049 1962 1962 1962 1962 1963 1912 1841 1786 1769 1756 1767 1883 1892 1849 1743 1751 1777 1797 1801 1798 1710 1658 1536 1443 1440 1404 1439 1543 1522 1482 1485 1520 1502 1482 1428 1397 1354 1354 1356 1270 1304 1301 1332 1385 1351 1376 1381 1485 1415 1311 1241 1120 1050 933 872 783 807 865 1015 1115 1243 1336 1474 1615 1528 1442 1328 1300 1329 1261 1194 1324 1311 1446 1531 1576 1468 1329 1225 1094 964 877 877 807 694 538 442 314 184 105 30 67 106 57 59 54 26 -27 -38 -44 -53 106 138 8 -135 -187 -162 -164 -179 -131 -82 23 147 208 95 -35 -148 -256 -377 -347 -300 -119 -127 -137 -169 -234 -296 -409 -469 -466 -555 -611 -591 -573 -575 -551 -501 -339 -452 -617 -817 -938 -1049 -1198 -1163 -1214 -1176 -1160 -1145 -1125 -1117 -1077 -1077 -1077 -1077 -1077 -1077 -1077 -1077 -1077 -1164 -1275 -1402 -1519 -1643 -1719 -1783 -1687 -1719 -1618 -1556 -1538 -1503 -1651 -1816 -1816 -1831 -1986 -2067 -2008 -2076 -2046 -1905 -1859 -2015 -2198 -2334 -2375 -2444 -2289 -2248 -2302 -2286 -2290 -2423 -2423 -2423 -2423 -2420 -2461 -2542 -2545 -2518 -2573 -2592 -2483 -2324 -2293 -2429 -2526 -2439 -2397 -2396 -2311 -2162 -2171 -2336 -2510 -2597 -2770 -2962 -3031 -3031 -3205 -3379 -3483 -3657 -3840 -3899 -3898 -4070 -4275 -4409 -4572 -4716 -4692 -4638 -4548 -4420 -4268 -4114 -3930 -3770 -3769 -3819 -3858 -3935 -3955 -3933 -3983 -3869 -3665 -3848 -3987 -4161 -4159 -4318 -4483 -4403 -4254 -4199 -4243 -4207 -4195 -4377 -4374 -4508 -4513 -4483 -4510 -4405 -4351 -4454 -4668 -4779 -4772 -4596 -4354 -4148 -4116 -4116 -4299 -4542 -4698 -4881 -4985 -5029 -5228 -5418 -5675 -5666 -5819 -5792 -5970 -6033 -6147 -6155 -5922 -5724 -5845 -6045 -6235 -6452 -6553 -6547 -6622 -6670 -6756 -6596 -6462 -6460 -6429 -6258 -6107 -5960 -5722 -5462 -5462 -5462 -5538 -5646 -5738 -5809 -5775 -5687 -5403 -5566 -5770 -5882 -5865 -5600 -5365 -5201 -5201 -5244 -5409 -5635 -5792 -6000 -6070 -6226 -6416 -6641 -6933 -6929 -6993 -7154 -7350 -7526 -7609 -7508 -7354 -7193 -7035 -7043 -7242 -7316 -7281 -7078 -7141 -7095 -7295 -7547 -7544 -7704 -7809 -7840 -7874 -7874 -7665 -7712 -7937 -8109 -8086 -8117 -8157 -8056 -8155 -8126 -7954 -7696 -7395 -7155 -7155 -7155 -7155 -7155 -7154 -7195 -7321 -7471 -7627 -7822 -7898 -7843 -7911 -7934 -7963 -7893 -7893 -8007 -8096 -7936 -7913 -7862 -7763 -7957 -7989 -7950 -7921 -7814 -8040 -8265 -8491 -8466 -8357 -8134 -7821 -7510 -7731 -7736 -7754 -7626 -7405 -7675 -7953 -8214 -8240 -8379 -8639 -8830 -9098 -9104 -9195 -9469 -9737 -9936 -9984 -10191 -10316 -10409 -10289 -10039 -9847 -9822 -9647 -9359 -9075 -8847 -8891 -9016 -9175 -9298 -9370 -9045 -8965 -9145 -9263 -9186 -8874 -8586 -8630 -8772 -8707 -8575 -8455 -8586 -8838 -9017 -9314 -9295 -9455 -9576 -9720 -9576 -9201 -9192 -9134 -8927 -8914 -8802 -8836 -8863 -8558 -8456 -8600 -8837 -8649 -8602 -8541 -8686 -8306 -7931 -7801 -8062 -8323 -8584 -8670 -8928 -9307 -9527 -9515 -9490 -9445 -9370 -9236 -9070 -8810 -8538 -8494 -8357 -8164 -8157 -8376 -8185 -8118 -7938 -8160 -7915 -7643 -7675 -7672 -7439 -7322 -7530 -7859 -8012 -8027 -8315 -8516 -8570 -8336 -7974 -8007 -7939 -7754 -7745 -7620 -7462 -7503 -7583 -7518 -7444 -7474 -7467 -7181 -7363 -7450 -7839 -8191 -8212 -8182 -8087 -7915 -7670 -7328 -7199 -6989 -6815 -7088 -6988 -6924 -6858 -6702 -6518 -6638 -6390 -6197 -6588 -6744 -7070 -7489 -7521 -7417 -7465 -7474 -7448 -7522 -7442 -7309 -7172 -6987 -7145 -6856 -6768 -6548 -6629 -6925 -6924 -6917 -6900 -6842 -6710 -6457 -6042 -5825 -5468 -5316 -5490 -5067 -4743 -4623 -4648 -4153 -3837 -4375 -4458 -4505 -4443 -4259 -4245 -3835 -3248 -3073 -3076 -2361 -2810 -3078 -3802 -3686 -3937 -3748 -4048 -3615 -3218 -2591 -2001 -1609 -1070 -1447 -1609 -1356 -1471 -1265 -1295 -1130 -935 35 -642 -979 -1693 -2170 -2484 -3238 -3850 -3404 -3010 -2417 -1936 -1308 -622 -270 -153 180 433 1160 1594 1782 1552 1378 1270 1731 1750 2035 2308 2080 3003 4148 5387 6024 5265 4490 4063 4157 4727 5173 5139 4374 4319 5492 6670 6757 5827 5541 6251 7128 7351 8047 9612 9877 11555 12970 13778 14746 16135 14772 13395 12409 12920 13979 14342 14723 15217 14662 17227 17959 18294 18520 19273 21913 20927 20029 23103 22405 25924 26304 26390 26405 30593 29570 33652 37927 42709 39548 44361 56718 65223 63218 80728 101239 112076 151768 270581 659938])

(defn position [data value]
  (-
    (dec (count data))
    (count (filter #(> % value) data))))

(defn cwcalc [income]
  (nth diffs (position data-2017 income)))

;;-------------------------
;; Helper Functions

(defn atom-input [value]
  [:input {:type "text"
           :value @value
           :on-change #(reset! value (-> % .-target .-value))}])

(defn shared-state []
  (let [val (reagent/atom "50000")]
    (fn []
      [:div
       [:p "Enter Your Individual Income: " [atom-input val]]
       [:p (if
            (> (js/parseInt @val) 0) (cond
                                       (> (cwcalc (js/parseInt @val)) 0) (str "You gained $" (cwcalc (js/parseInt @val)) " per year in the class war.")
                                      :else (str "You lost $" (* -1 (cwcalc (js/parseInt @val))) " per year in the class war" ))
            "Please enter an income value greater than 0.")]
       ])))

;; -------------------------
;; Views

(defn home-page []
  [:div [:h2 "Class War Calculator:"]
   [shared-state]])

(reagent/render-component [home-page]
                          (. js/document (getElementById "app")))

(defn on-js-reload []
  ;; optionally touch your app-state to force rerendering depending on
  ;; your application
  ;; (swap! app-state update-in [:__figwheel_counter] inc)
)
